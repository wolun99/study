## 전송계층

- 목적지에 신뢰할 수 있는 데이터를 전송하는가에 중점
- 주요 프로토콜은 TCP UDP
- TCP 데이터를 신뢰성있게 데이터를 전송하는 역할
- 전송 계층 통신 방식
  - 연결형 통신 : 신뢰성과 정확성(TCP프로토콜)
  - 비연결형 통신 : 효율설 (UDP프로토콜)
- 데이터 단위는 세그먼트

## TCP 세그먼트

- TCP 헤더는 위에서부터 출발 포트 번호, 목적지 포트 번호 , 일련 번호, 확인응답 번호, 헤더 길이, 예약 영역 , TCP 플래그(코드비트), 윈도우 크기, 체크섬, 긴급 포인터, TCP옵션
- 목적지까지 정확하게 전달하기 위한 정보를 가지고 있음
- TCP 헤더 각 항목
  - 출발지 포트번호(16bit)
  - 목적지 포트번호(16bit)
  - 일련번호(32bit) : 순서번호라고도 함, 송신자가 지정하는 순서 번호
  - 확인 응답 번호(32bit) : 데이터를 정상적으로 수신했을 시 보내는 번호
  - 헤더의 길이(4bit) : 가변적이여서 정확하게 헤더의 길이를 확인하기 위해 사용
  - 예약 영역(6bit)
  - TCP 플래그(6bit) : 각비트가 활성화되면서 데이터 전송
    - URG
    - ACK
    - PSH
    - RST
    - SYN
    - FIN
  - 윈도우 크기(16bit) : 한 번에 전솔항 수 있는 데이터의 양
  - 체크섬(16bit) : 에러 검출용
  - 긴급 포인터(16bit) : 긴급데이터 처리

## 3-way handshake, 4-way handshake

- 가상의 통신로를 확보하기 위한 과정
- 3-way handshake
  1. SYN으로 연결 요청확인
  2. SYN+ACK 연결확인 후 다시 요청
  3. ACK 확인 후 정보 전송
- 4-way handshake(연결종료시)
  1. FIN으로 연결 종료 요청(각각 다름)
  2. ACK 확인한것을 전송
  3. FIN으로 연결 종료 확인 요청(각각 다름)
  4. ACK 확인한것을 전송

## TCP 에러제어

- 에러 검출 과정(detection)
  - CRC(cyclic Redundancy Check)
  - Checksum(체크섬)
- 에러정정(correction) : ARQ(Automatic Repeat Request)를 사용
- 재전송방식은 세가지
  - Stop and Wait ARQ : 타임아웃 되어도 ACK를 받지 못하면 패킷을 재전송하는 방식(식별을 위해 0과1 또는 ACK를 번갈아 전송) 비효율적이라는 단점이 있음
  - Go-Back-n ARQ : 돌아오지 않아 에러가 발생했으면 그 번호의 패킷부터 다시 전송하는 방식
  - Selective Repeat ARQ : 오류가 발생한 패킷을 선택적으로 재전송하는 방식

## TCP 흐름제어

- 송수신지의 데이터 처리능력이 달라 데이터가 유실되는 것을 방지하는 기법
  - Stop and Wait : 비효율적 에러제어와 같은 동작
  - 슬라이딩 윈도우(Sliding Window) : 윈도우 광고 기법을 사용
- 송신측 윈도우는 Congestion window로 cwnd라고 표기
- 수신측 윈도우는 Receiver window로 rwnd라고 표기
- 슬라이딩 윈도우
  1. 자신의 윈도우 크기를 알림
  2. 보내고자하는 데이터 크기 보냄
  3. 받은 데이터를 버퍼에 저장하고 윈도우의 크기는 받은 데이터의 크기로 윈도우 크기를 뺀것 확인응답 ACK를 보냄
  4. 송신지 윈도우 크기도 같아짐

## TCP 혼잡제어

- 네트워크 내의 데이터를 조절하여 오버플로우(overflow)현상을 방지하는 기술
- 혼잡 발생 전
  - Slow Start
  - Additive Increase
- 혼잡 발생 후
  - Multiplicative Decrease
- 혼잡 발생 인식
  - 전송한 세그먼트 재전송
  - 3개의 중복된 ACK 수신
- 혼잡 발생전에 TCP는 세그먼트들을 Slow Start 방식으로 하나씩 전송하고 이때 cwnd는 지수적 증가를 가짐 cwnd의 임계점을 ssthresh라 부름
- 임계점 부근까지 오면 Addictive Increase(cwnd를 하나씩 증가하면서 혼잡을 회피)를 사용해 혼잡을 회피합니다.
- 결국 혼잡을 감지하면 Multiplicative Decrease를 사용하고 cwnd를 1로 설정하면 임계점을 반으로 줄이고 다시 Slow Start를 수행함
- 3개의 중복된 ACk를 수신하면 ssthresh의 값을 반으로 줄이고 cwnd를 ssthresh 값으로 재설정

## 포트번호

- 데이터의 목적지가 어떤 애플리케이션인지 구분하는 기능
- Well-Known 포트(국제 인터넷 주소 관리 기구(IANA)에서 지정)0~1023 까지의 포트 번호
  - SSH(22) : 파일전송
  - TELNET(23) : 원격지 호스트 연결
  - SMTP(25) : 메일 전송
  - DNS(53) : 도메인 네임 서비스
  - HTTP(80) : 웹 서비스
  - POP3(110) : 메일 수신
  - IMAP(143) : 메일 수신
  - HTTPS(443) : 웹 서비스(보안 강화)

## UDP

- 효율성에 초점을 둠
- 비연결형 속도가 빠름
- UDP헤더가 붙으면 UDP 세그먼트
- UDP 헤더는 출발지 포트 번호, 목적지 포트 번호, 길이, 체크섬 순으로 이루어져 있음
- 연결 확립 절차 x
- 브로드 캐스팅 전송
