## JWT(JSON Web Token)

- 인증에 필요한 정보들을 암호화시킨 JSON토큰
- HTTP 헤더에 실어 JWT토큰을 서버가 식별하는 방식
- 사용자가 JWT를 서버로 전송하면 서버는 서명을 검증하는 과정을 거치게 되면서 검증이 완료되면 요청한 응답을 돌려줍니다.

### JWT 구조

- 헤더(Header) : JWT에서 사용할 타입과 해시 알고리즘의 종류
- 내용(Payload) : 서버에서 첨부한 사용자 권한 정보와 데이터
- 서명(Signature) : 개인키로 서명한 전자서명

#### 헤더(Header)

```js
    {
      "alg":"HS256",
      "typ":"JWT"
    }
```

- alg: 서명 암호화 알고리즘
- typ : 토큰 유형

#### 내용(payload)

- 토큰에서 사용할 정보 조각들이 담겨있습니다.

```js
  {
    "sub":"123456",
    "name":"kim",
    "iat":"153333562"
  }
```

- 정해진 데이터 타입은 없지만 세가지로 나뉩니다.
  - Registed claims : 미리 정의된 클레임
  - Public claims : 사용자가 정의할 수 있는 클레임 공개용 정보 전달을 위해 사용
  - Private claims : 해당하는 당사자들 간에 정보를 공유하기 위해 만들어진 사용자 지정 클레임

#### 서명(Signature)

- 시그니처에서 사용하는 알고리즘은 헤더에서 정의한 알고리즘 방식을 사용합니다.
- 시그니처 구조는 (헤더+페이로드)와 서버를 갖고 있는 유일한 key를 합친 것을 헤더에서 정의한 알고리즘으로 암호화 합니다.

### JWT를 이용한 인증 과정

1. 사용자가 ID,PW를 입력하여 서버에 로그인 요청을 합니다.
2. 인증 요청을 받으면 , Header,PayLoad,Signature를 정의합니다. 이를 Base64로 한 번 더 암호화하여, JWT를 생성하여 쿠키에 담아 클라이언트에게 발급합니다.
3. 클라이언트는 JWT를 로컬 스토리지나 쿠키등에 저장합니다.
4. API를 서버에 요청할때 Authorization header에 Access Token을 담아서 보냅니다.
5. 서버는 JWT가 서버 내에서 발행한 토큰인지 여부를 확인하여 일치하면 인증을 하여 주고 아니면 인증이 되지 않습니다.
6. 클라이언트가 서버에 요청했을때 만일 액세스 토큰의 시간이 만료되면 클라이언트는 리프래시 토큰을 이용하여 서버로부터 새로운 엑서스 토큰을 발급 받습니다.

### JWT 장단점

1. 장점

   - Header와 Payload 를 가지고 Signature를생성하므로 데이터 위변조를 막을 수 있습니다.
   - 별도의 저장소가 필요없습니다.
   - 기본 정보와 전달할 정보 및 검증을 증명하는 서명 등 필요한 정보를 자체적으로 지니고 있습니다.
   - 서버는 무상태가 되어 서버 확장성이 우수해질 수 있습니다.
   - 다른 로그인 시스템에 접근 및 권한 공유가 가능합니다.
   - OAuth의 경우 Facebook, Google 등 소셜 계정을 이용하여 다른 웹서비스에서도 로그인을 할 수 있습니다.
   - 모바일 어플리케이션 환경에서도 잘 동작합니다.

2. 단점

   - 토큰 자체에 정보를 담고 있으므로 위험할 수 있습니다.
   - 정보가 많아질수록 토큰의 길이가 늘어나 네트워케 부하를 줄 수 있습니다.
   - payload 자체가 암호화 된것이 아니기에 중간에 poayload를 탈취하여 디코딩 하면 데이터를 확인할 수 있으므로 , 중요 데이터를 넣지 않아야 합니다.
   - stateless 특징을 가지기 때문에 토큰 자체를 탈취당하면 대처하기가 어렵습니다.
